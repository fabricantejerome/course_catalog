{% extends 'partials/template.twig' %}

{% block head %}
	{{ parent() }}
	<style type="text/css">
		.code {
			width: 100px;
		}
		.units {
			width: 50px;
		}
		.course-code,
		.course-title {
			font-size: 30px;
			font-weight: bold;
			height: 50px;
		}
	</style>
{% endblock %}

{% block content %}
{# Main content #}
<section class="content">
	<div class="row" id="app">
		<div class="col-md-12">
			{# Box element #}
			<div class="box box-danger">
				{# box-header #}
				<div class="box-header with-border">
					<h3 class="box-title">Search Curriculum</h3>
				</div>
				{# End of box header #}

				{# box body #}
				<div class="box-body">
					{# Row #}
					<div class="row">
						<div class="col-md-4">
							<select name="course-code" id="course-code" ref="courseCode" class="select2 form-control">
								<option selected disabled><-- Select Course --></option>
								<option v-for="entity of courseObject" v-bind:value="entity.id">
									${ entity.title }
								</option>
							</select>
						</div>

						<div class="col-md-2">
							<select name="year" id="year" ref="year" class="select2 form-control">
								<option selected disabled><-- Select Year --></option>
								<option v-for="(entity, index) of subjects" v-bind:value="index">
									${ yearValues[index] }
								</option>
							</select>
						</div>

						<div class="col-md-2">
							<select name="sem" id="sem" ref="sem" class="select2 form-control">
								<option selected disabled><-- Select Semester --></option>
								<option v-for="(entity, index) of subjects[yearSelected]" v-bind:value="index">
									${ semValues[index] }
								</option>
							</select>
						</div>

						<div class="col-md-4">
							<select name="subject" id="subject" ref="subject" class="select2 form-control">
								<option selected disabled><-- Select Subject --></option>
								<option v-for="(entity, index) of subjects[yearSelected][semSelected]" v-bind:value="entity.id">
									${ entity.title }
								</option>
							</select>
						</div>

						<div class="col-md-12 text-center">
							<h4>First Year</h4>
						</div>

						<div class="col-md-6">
							<h5>First Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.firstYear.firstSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-6">
							<h5>Second Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.firstYear.secondSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-12 text-center">
							<h4>Second Year</h4>
						</div>

						<div class="col-md-6">
							<h5>First Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.secondYear.firstSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-6">
							<h5>Second Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.secondYear.secondSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-12 text-center">
							<h4>Third Year</h4>
						</div>

						<div class="col-md-6">
							<h5>First Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.thirdYear.firstSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-6">
							<h5>Second Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.thirdYear.secondSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-12 text-center">
							<h4>Fourth Year</h4>
						</div>

						<div class="col-md-6">
							<h5>First Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.fourthYear.firstSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>

						<div class="col-md-6">
							<h5>Second Semester</h5>
							<table class="table">
								<thead>
									<tr>
										<th>Code</th>
										<th>Title</th>
										<th>Units</th>
									</tr>
								</thead>

								<tbody>
									<tr v-for="(item, index) in subjects.fourthYear.secondSem">
										<td>${ item.code }</td>
										<td>${ item.title }</td>
										<td>${ item.units }</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					{# End row #}

				</div>
				{# end box body #}
			</div>
			{# End of box #}
		</div>
	</div>
</section>
{# End main content #}
{% endblock %}
{% block script %}
	{{ parent() }}
	{# Vue #}
	<script src="{{ base_url('resources/js/axios/axios.min.js') }}"></script>
	<script src="{{ base_url('resources/js/vue/vue.min.js') }}"></script>
	<script src="{{ base_url('resources/js/lodash/lodash.js') }}"></script>
	<script src="{{ base_url('resources/js/vee-validate/vee-validate.min.js') }}"></script>

	<script type="text/javascript">
		Vue.use(VeeValidate);

		const appUrl = "{{ base_url() }}";

		const courseId = "{{ id }}";

		const app = new Vue({
			el: '#app',
			delimiters: ['${', '}'],
			data: {
				course: {
					code: '',
					title: '',
				},
				courseObject: [],
				yearValues: { 
					firstYear: 'First Year',
					secondYear: 'Second Year',
					thirdYear: 'Third Year',
					fourthYear: 'Fourth Year',
				},
				semValues: { 
					firstSem: 'First Semester',
					secondSem: 'Second Semester',
				},
				yearSelected: 'firstYear',
				semSelected: 'firstSem',
				subjects: {
					firstYear: {
						firstSem: [], 
						secondSem: []
					},
					secondYear: {
						firstSem: [], 
						secondSem: []
					},
					thirdYear: {
						firstSem: [], 
						secondSem: []
					},
					fourthYear: {
						firstSem: [], 
						secondSem: []
					},
				},
				subjectOptions: []
			},
			created() {
				this.fetchCourses()
			},
			mounted() {
				const self = this
				$(self.$refs.courseCode).on('change', function() {
					let id = $(this).val()

					self.fetchSubjects(id)
				})

				$(self.$refs.year).on('change', function() {
					self.yearSelected = $(this).val()
				})

				$(self.$refs.sem).on('change', function() {
					self.semSelected = $(this).val()
				})
			},
			methods: {
				addRow: function(container) {
					container.push({code: '', title: '', units: ''});
				},
				removeRow: function(container, index) {
					container.splice(index, 1)
				},
				performSubmission: function() {
					axios({
						url: appUrl + 'curriculum/store',
						method: 'post',
						data: {
							course:   this.course,
							subjects: this.subjects
						}
					})
					.then((response) => {
						console.log(response.data)
						alert('Curriculum has been edited')
					})
					.catch((error) => {
						console.log(error)
					})
				},
				getCourse: function(courseId) {
					axios({
						url: appUrl + 'curriculum/ajaxReadCourse/',
						method: 'post',
						data: {
							id: courseId
						}
					})
					.then((response) => {
						console.log(response.data)
						this.course = response.data
					})
					.catch((error) => {
						console.log(error)
					})
				},
				fetchSubjects: function(courseId) {
					axios({
						url: appUrl + 'curriculum/ajaxFetchSubjects/',
						method: 'post',
						data: {
							id: courseId
						}
					})
					.then((response) => {
						console.log(response.data)
						this.subjects = response.data
					})
					.catch((error) => {
						console.log(error)
					})
				},
				fetchCourses: function() {
					axios({
						url: appUrl + 'curriculum/ajaxFetchCourses/',
						method: 'get'
					})
					.then((response) => {
						console.log(response.data)
						this.courseObject = response.data
					})
					.catch((error) => {
						console.log(error)
					})
				}
			}
		});
	</script>
{% endblock %}